<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çemberi Adım Adım Öğren</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366F1;
            --background-color: #F3F4F6;
            --text-color: #1F2937;
            --correct-color: #10B981;
            --incorrect-color: #EF4444;
            --card-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --input-border: #D1D5DB;
            --input-bg: #F9FAFB;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 800px;
            text-align: center;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 800;
            color: var(--primary-color);
        }
        .preparer {
            font-size: 1rem;
            color: #6B7280;
            margin-bottom: 25px;
        }
        .card {
            background-color: var(--card-bg);
            border-radius: 24px;
            padding: 40px 45px;
            box-shadow: 0 10px 40px var(--shadow-color);
        }
        #activity-text p {
            font-size: 1.25rem;
            text-align: left;
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            line-height: 2.2;
        }
        #activity-text p span, #activity-text p .blank-container {
            margin-right: 0.4em;
        }
        #activity-text {
            transition: opacity 0.4s ease-in-out;
        }
        .blank-container {
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
            gap: 5px;
        }
        .correct-answer-display {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--correct-color);
        }
        .blank {
            width: 120px;
            height: 40px;
            font-size: 1.2rem;
            font-family: inherit;
            font-weight: 700;
            text-align: center;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            background-color: var(--input-bg);
            transition: all 0.2s;
        }
        .blank:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .blank.empty {
            border-color: #F59E0B;
        }
        .blank.correct {
            background-color: #ECFDF5;
            border-color: var(--correct-color);
            color: var(--correct-color);
        }
        .blank.incorrect {
            background-color: #FEF2F2;
            border-color: var(--incorrect-color);
            color: var(--incorrect-color);
        }
        #progress-container {
            width: 100%;
            background-color: #E5E7EB;
            border-radius: 10px;
            margin-top: 30px;
            overflow: hidden;
            height: 10px;
        }
        #progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), #A78BFA);
            transition: width 0.5s ease-in-out;
        }
        .controls {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        #check-btn {
            background-color: var(--primary-color);
        }
        #next-btn {
            background-color: #34D399;
            display: none;
        }
        #reset-btn {
            background-color: var(--primary-color);
        }
        #win-screen {
            display: none;
        }
        #win-screen p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            .card {
                padding: 20px;
            }
            #activity-text p {
                font-size: 1.1rem;
                line-height: 2.5;
            }
            .blank {
                width: 90px;
                height: 35px;
                font-size: 1rem;
            }
            .controls {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
        }
    </style>
    <script src="scorm_api.js"></script>
</head>
<body>
    <div class="container">
        <h1>Çemberi Adım Adım Öğren</h1>
        <p class="preparer">Hazırlayan: Osman AYDOĞDU</p>
        <div class="card">
            <div id="activity-text" style="opacity: 1;">
                <p>
                    <span>Bir</span><span>noktaya</span><span>eşit</span><span>uzaklıktaki</span><span>noktaların</span><span>oluşturduğu</span><span>geometrik</span><span>şekle</span>
                    <span class="blank-container"><input type="text" class="blank" id="blank-0" data-answers="çember" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><span class="correct-answer-display"></span></span>
                    <span>denir.</span><span>Referans</span><span>alınan</span><span>bu</span><span>nokta</span>
                    <span class="blank-container"><input type="text" class="blank" id="blank-1" data-answers="merkez" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><span class="correct-answer-display"></span></span>
                    <span>olarak</span><span>adlandırılır.</span>
                </p>
            </div>
            <div class="controls">
                <button id="check-btn" class="btn" disabled style="display: block;">Kontrol Et</button>
                <button id="next-btn" class="btn" style="display: none;">Devam Et</button>
            </div>
            <div id="progress-container">
                <div id="progress-bar"></div>
            </div>
        </div>
        <div id="win-screen" class="card" style="margin-top: 20px;">
            <p>Etkinliği tamamladın.</p>
            <button id="reset-btn" class="btn">Yeniden Başla</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const activityTextContainer = document.getElementById('activity-text');
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');
            const resetBtn = document.getElementById('reset-btn');
            const progressBar = document.getElementById('progress-bar');
            const winScreen = document.getElementById('win-screen');
            const activityCard = document.querySelector('#activity-text').parentElement;

            const textSections = [
                "Bir noktaya eşit uzaklıktaki noktaların oluşturduğu geometrik şekle *çember* denir. Referans alınan bu nokta *merkez* olarak adlandırılır.",
                "Merkez ile çember üzerindeki bir noktayı birleştiren doğru parçasına *yarıçap* denir.",
                "Çember üzerinde bulunan iki noktayı merkezden geçerek birleştiren doğru parçasına *çap* denir.",
                "Çap uzunluğu, yarıçap uzunluğunun *iki/2* katıdır.",
                "Yarıçap *r|case* harfi ile, çap ise *R|case* harfi ile gösterilir.",
                "İki çember iki noktada kesişirse, bu noktalar ile çemberlerden birine ait merkez noktası kullanılarak *üçgen* inşa edilebilir.",
                "Bir çember ile bu çemberin iç kısmındaki tüm noktaların oluşturduğu geometrik şekle *daire* denir."
            ];
            let currentSectionIndex = 0;

            const levenshtein = (s1, s2) => {
                let l = s1, s = s2;
                if (s1.length < s2.length) { l = s2; s = s1; }
                let lL = l.length;
                if (lL == 0) return 1;
                let c = new Array();
                for (let i = 0; i <= s1.length; i++) {
                    let lastValue = i;
                    for (let j = 0; j <= s2.length; j++) {
                        if (i == 0) c[j] = j;
                        else if (j > 0) {
                            let nV = c[j - 1];
                            if (s1.charAt(i - 1) != s2.charAt(j - 1))
                                nV = Math.min(Math.min(nV, lastValue), c[j]) + 1;
                            c[j - 1] = lastValue;
                            lastValue = nV;
                        }
                    }
                    if (i > 0) c[s2.length] = lastValue;
                }
                return c[s2.length];
            };

            function normalizeString(str) {
                return str.trim().toLocaleUpperCase('tr-TR');
            }

            function loadSection(index) {
                activityTextContainer.style.opacity = 0;
                setTimeout(() => {
                    const sectionText = textSections[index];
                    const regex = /([^*]+)|\*([^*|]+)(?:\|(case))?\*/g;
                    let match;
                    let htmlContent = '<p>';
                    let blankIndex = 0;
                    while ((match = regex.exec(sectionText)) !== null) {
                        if (match[1]) {
                            match[1].trim().split(' ').forEach(word => {
                                htmlContent += `<span>${word}</span>`;
                            });
                        } else if (match[2]) {
                            const answers = match[2].split('/').join(',');
                            const isCaseSensitive = match[3] === 'case';
                            const caseAttribute = isCaseSensitive ? 'data-case-sensitive="true"' : '';
                            htmlContent += `<span class="blank-container"><input type="text" class="blank" id="blank-${blankIndex++}" data-answers="${answers}" ${caseAttribute} autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><span class="correct-answer-display"></span></span>`;
                        }
                    }
                    htmlContent += '</p>';
                    activityTextContainer.innerHTML = htmlContent;
                    checkBtn.style.display = 'block';
                    nextBtn.style.display = 'none';
                    checkBtn.disabled = true;
                    activityTextContainer.style.opacity = 1;
                    addInputListeners();
                }, 400);
            }

            function addInputListeners() {
                const blanks = activityTextContainer.querySelectorAll('.blank');
                blanks.forEach(blank => {
                    blank.addEventListener('input', () => {
                        let allFilled = true;
                        blanks.forEach(b => {
                            b.classList.remove('empty');
                            if (b.value.trim() === '') allFilled = false;
                        });
                        checkBtn.disabled = !allFilled;
                    });
                });
            }

            function checkAnswers() {
                const blanks = activityTextContainer.querySelectorAll('.blank');
                if (blanks.length === 0) return true;
                let allFilled = true;
                blanks.forEach(b => {
                    if (b.value.trim() === '') allFilled = false;
                });
                if (!allFilled) {
                    blanks.forEach(b => {
                        if (b.value.trim() === '') b.classList.add('empty');
                    });
                    return false;
                }

                blanks.forEach(blank => {
                    const container = blank.parentElement;
                    const correctionEl = container.querySelector('.correct-answer-display');
                    correctionEl.innerHTML = '';

                    const isCaseSensitive = blank.dataset.caseSensitive === 'true';
                    const userValueRaw = blank.value.trim();
                    const userValueNormalized = normalizeString(userValueRaw);
                    const correctAnswersRaw = blank.dataset.answers.split(',');
                    const correctAnswersNormalized = normalizeString(blank.dataset.answers).split(',');
                    let isCorrect = false;

                    if (isCaseSensitive) {
                        if (correctAnswersRaw.includes(userValueRaw)) {
                            isCorrect = true;
                        }
                    } else {
                        for (const answer of correctAnswersNormalized) {
                            const similarity = (answer.length - levenshtein(userValueNormalized, answer)) / answer.length;
                            const threshold = answer.length <= 1 ? 1 : 0.8;
                            if (similarity >= threshold) {
                                isCorrect = true;
                                break;
                            }
                        }
                    }

                    blank.classList.remove('correct', 'incorrect');
                    if (isCorrect) {
                        blank.classList.add('correct');
                    } else {
                        blank.classList.add('incorrect');
                        const correctAnswer = correctAnswersRaw[0];
                        correctionEl.innerHTML = `✓ ${correctAnswer}`;
                    }
                });
                return true;
            }

            function showNextSection() {
                currentSectionIndex++;
                const progress = (currentSectionIndex / textSections.length) * 100;
                progressBar.style.width = `${progress}%`;
                if (currentSectionIndex < textSections.length) {
                    loadSection(currentSectionIndex);
                } else {
                    activityCard.style.display = 'none';
                    winScreen.style.display = 'block';
                }
            }

            function resetActivity() {
                winScreen.style.display = 'none';
                activityCard.style.display = 'block';
                currentSectionIndex = 0;
                progressBar.style.width = '0%';
                loadSection(currentSectionIndex);
            }

            checkBtn.addEventListener('click', () => {
                if (checkAnswers()) {
                    checkBtn.style.display = 'none';
                    nextBtn.style.display = 'block';
                    document.querySelectorAll('.blank').forEach(b => b.disabled = true);
                }
            });

            nextBtn.addEventListener('click', showNextSection);
            resetBtn.addEventListener('click', resetActivity);

            loadSection(currentSectionIndex);
        });
    </script>
</body>
</html>